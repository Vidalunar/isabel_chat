<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Chat educativo con Isabel I de Castilla, proyecto de Patricia Romero Educaci√≥n" />
  <meta name="theme-color" content="#111827" />
  <title>isabel-chat ¬∑ Patricia Romero Educaci√≥n</title>
  <link rel="icon" href="../pr-sello.png" type="image/png" />

  <!-- Extensiones opcionales (solo cliente) -->
  <!-- html2canvas + jsPDF para exportar a PDF -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" defer></script>

  <style>
    :root {
      --primary: #111827;
      --bg: #faf7f2;
      --panel: #ffffff;
      --text: #111827;
      --muted: #5f6368;
      --accent: #0070f3;
      --radius: 16px;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); }

    header.topbar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 1rem 1.5rem;
      background: var(--primary);
      color: var(--bg);
      box-shadow: var(--shadow);
      gap: 12px;
    }
    header .brand { display: flex; align-items: center; gap: 8px; font-weight: 600; letter-spacing: 0.5px; }
    header .actions { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .btn {
      border: none; border-radius: 999px; padding: .55rem .9rem;
      background: #1f2937; color: #fff; cursor: pointer; font-weight: 600; font-size: .9rem;
      box-shadow: 0 2px 8px rgba(0,0,0,.15);
    }
    .btn:hover { opacity: .95; }
    .btn.secondary { background: #374151; }
    .btn.icon { display: inline-flex; align-items: center; gap: .45rem; }
    .btn[disabled] { opacity: .5; cursor: not-allowed; }

    main.layout {
      display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;
      max-width: 1200px; margin: 2rem auto; padding: 0 1rem;
    }
    .chat {
      display: flex; flex-direction: column; gap: 1rem;
      background: var(--panel); border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 1rem;
    }
    .messages { flex: 1; overflow-y: auto; padding: 0.5rem; }
    .message { margin-bottom: 1rem; position: relative; }
    .role { font-weight: 600; margin-bottom: 0.25rem; }
    .bubble {
      background: #f0f2f5; padding: 0.75rem 1rem; border-radius: var(--radius);
      box-shadow: 0 1px 4px rgba(0,0,0,0.1); white-space: pre-wrap;
    }
    .tts-controls {
      position: absolute; top: 0; right: 0;
      transform: translateY(-50%);
      display: flex; gap: 6px;
    }
    .tts-btn {
      border: none; background: #111827; color: #fff;
      border-radius: 999px; padding: .2rem .5rem; font-size: .8rem; cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,.2);
    }
    .tts-btn:hover { opacity: .9; }

    .composer { display: flex; gap: 0.5rem; }
    .composer input {
      flex: 1; padding: 0.75rem 1rem; border-radius: var(--radius);
      border: 1px solid #ddd; font-size: 1rem;
    }
    .composer button {
      padding: 0.75rem 1.5rem; border-radius: var(--radius);
      background: var(--primary); color: var(--bg); border: none; cursor: pointer; font-weight: 600;
    }
    .composer button:hover { opacity: 0.9; }

    aside.sources {
      background: var(--panel); border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 1rem; overflow-y: auto;
    }
    aside.sources h2 { margin-top: 0; font-size: 1.1rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem; }
    .source-item { margin-bottom: 0.75rem; }
    .source-item .meta { font-size: 0.85rem; color: var(--muted); }
    .source-item .snippet { font-size: 0.95rem; }

    footer.foot {
      text-align: center; font-size: 0.9rem; color: var(--muted);
      padding: 1rem; border-top: 1px solid #eee;
    }

    @media (max-width: 900px) {
      main.layout { grid-template-columns: 1fr; }
      .tts-controls { position: static; transform: none; margin-top: .3rem; }
    }

    /* Portada del PDF (modal) */
    dialog#exportDlg { border: none; border-radius: 16px; padding: 0; box-shadow: 0 12px 40px rgba(0,0,0,.25); max-width: 560px; }
    .dlg-body { padding: 16px; background: #fff; border-radius: 16px; }
    .dlg-row { display: grid; gap: 8px; margin-bottom: 12px; }
    .dlg-row label { font-size: .9rem; color: #333; }
    .dlg-row input { padding: .6rem .8rem; border: 1px solid #e5e7eb; border-radius: 10px; }
    .dlg-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">Patricia Romero ¬∑ Educaci√≥n</div>
    <div class="actions">
      <div id="backendStatus">‚è≥ Comprobando backend‚Ä¶</div>
      <button id="exportPdfBtn" class="btn icon" title="Exportar conversaci√≥n a PDF">üìÑ Exportar PDF</button>
      <button id="stopTtsBtn" class="btn secondary icon" title="Detener lectura">‚èπÔ∏è Detener audio</button>
    </div>
  </header>

  <main class="layout">
    <section class="chat">
      <div id="messages" class="messages"></div>
      <form id="chatForm" class="composer">
        <input id="userInput" type="text" placeholder="Escribe tu pregunta para Isabel I‚Ä¶" autocomplete="off" required />
        <button type="submit">Enviar</button>
      </form>
    </section>

    <aside class="sources">
      <h2>Citas y Fuentes</h2>
      <div id="sources"><p class="muted">No hay citas todav√≠a.</p></div>
    </aside>
  </main>

  <footer class="foot">
    ¬© 2025 Patricia Romero ¬∑ Educaci√≥n hist√≥rica interactiva
  </footer>

  <!-- Di√°logo de exportaci√≥n a PDF -->
  <dialog id="exportDlg">
    <div class="dlg-body">
      <h3 style="margin:0 0 8px 0;">Exportar a PDF</h3>
      <div class="dlg-row">
        <label for="schoolName">Nombre del centro</label>
        <input id="schoolName" placeholder="Deutsche Schule Madrid (DSM)" />
      </div>
      <div class="dlg-row">
        <label for="coverTitle">T√≠tulo de la actividad</label>
        <input id="coverTitle" placeholder="Isabel I ¬∑ Conversaci√≥n guiada" />
      </div>
      <div class="dlg-row">
        <label for="studentName">Nombre del alumno/grupo (opcional)</label>
        <input id="studentName" placeholder="Grupo 3¬∫ESO A" />
      </div>
      <div class="dlg-actions">
        <button id="cancelExport" class="btn secondary">Cancelar</button>
        <button id="confirmExport" class="btn">Crear PDF</button>
      </div>
      <small style="color:#6b7280">El PDF se genera en tu navegador (no se env√≠a al servidor).</small>
    </div>
  </dialog>

  <script>
    /* Configuraci√≥n: puedes pasar ?api=... y ?school=... en la URL */
    window.BACKEND_URL = new URLSearchParams(location.search).get('api') || 'http://localhost:8000';
    window.SCHOOL_NAME = new URLSearchParams(location.search).get('school') || 'Deutsche Schule Madrid (DSM)';
  </script>
  <script src="main.js" defer></script>
</body>
</html>
